apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - oauth-client.yaml
  - external-secret.yaml
  - app-config.yaml
  - backstage.yaml

# Update these values for your environment:
# 1. Replace sandbox2222 with your SANDBOX_ID
# 2. Replace the secret value with the OAUTH_SECRET from AWS Secrets Manager
#    (the same value stored in ocppe/developer-hub -> oauth-client-secret)
#
# Generate secrets:
#   OAUTH_SECRET=$(openssl rand -base64 32)
#   aws secretsmanager create-secret --name ocppe/developer-hub \
#     --secret-string "{\"backend-secret\":\"...\",\"oauth-client-secret\":\"${OAUTH_SECRET}\"}"
patches:
  - patch: |-
      - op: replace
        path: /redirectURIs/0
        value: https://backstage-developer-hub-rhdh.apps.hub.ocp.sandbox2222.opentlc.com/api/auth/oidc/handler/frame
      - op: replace
        path: /secret
        value: REPLACE_WITH_OAUTH_SECRET_FROM_AWS
    target:
      kind: OAuthClient
      name: developer-hub
